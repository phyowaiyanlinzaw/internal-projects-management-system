<!--

    TODO :: DEPARTMENT'S DETAILS DESIGN IN MODAL

    TODO :: ADD DEPARTMENT FUNCTIONALITY

    TODO :: CHANGE FORM DESIGN FOR ADD DPARTMENT

 -->
<!DOCTYPE html>
<html
        lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Internal Project Management</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <meta
            name="keywords"
            content="project, management, project management, teamplaceholder project management"
    />
    <meta content name="description"/>
    <meta name="author" content="teamplaceholder's project"/>

    <!-- Favicon -->
    <!-- <link href="/images/favicon.ico" rel="icon"> -->

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com"/>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
    <link
            href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600;700&display=swap"
            rel="stylesheet"
    />

    <!-- bootstrap icons -->
    <link rel="stylesheet" href="/font/bootstrap-icons.min.css"/>

    <!-- Libraries Stylesheet -->
    <link
            href="/lib/owlcarousel/assets/owl.carousel.min.css"
            rel="stylesheet"
    />
    <link
            href="/lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css"
            rel="stylesheet"
    />
    <link rel="stylesheet" href="/lib/quill/quill.bubble.css"/>
    <link rel="stylesheet" href="/lib/quill/quill.snow.css"/>
    <link href="/css/bootstrap.min.css" rel="stylesheet"/>

    <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/gh/habibmhamadi/multi-select-tag/dist/css/multi-select-tag.css"
    />

    <link href="/css/daypilot.css" rel="stylesheet" type="text/css"/>

    <!-- datepicker -->
    <link
            rel="stylesheet"
            type="text/css"
            href="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.css"
    />
    <link
            rel="stylesheet"
            type="text/css"
            href="https://uicdn.toast.com/tui.time-picker/latest/tui-time-picker.css"
    />

    <!--  select-->
    <!-- <link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css"> -->

    <!-- Bootstrap Tables -->
    <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.18.2/bootstrap-table.min.css"
    />

    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.14.0/css/bootstrap-select.min.css"> -->

    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css"> -->
    <!-- Template Stylesheet -->
    <link href="/css/style.css" rel="stylesheet"/>
    <!-- <link href="/css/bootstrap-select2.min.css" rel="stylesheet" /> -->

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tagify/4.2.0/tagify.css">

    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tagify/4.2.0/tagify.min.js"></script>
    <link rel="stylesheet" href="/css/bootstrap.min.css"/>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="/js/custome.js" defer></script>
    <script type="module" defer>

        import {getData} from "/js/api-function.js";

        const a = console.log;


        const motherContainer = document.querySelector("#sort-container");

        const fragment = document.createDocumentFragment();

        function getAllDepartments() {
            return fetch('/api/department/list')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .catch(error => {
                    console.error('Fetch error:', error);
                    throw error;
                });
        }

        let dpList = [];

        // Call the function when needed
        getAllDepartments()
            .then(data => {
                dpList = [...data];
                a('dp list', dpList);

                    // let currentProject = dpList[i];
                    // Do something with currentProject
                    for (let i = 0; i < dpList.length; i++) {
                        a(dpList[i])
                        let currentDp = dpList[i];

                        // Create the outermost <div> with class "col-lg-4 col-md-4" and style
                        const outerDiv = document.createElement("div");
                        outerDiv.classList.add("col-lg-4", "col-md-4");
                        outerDiv.style.paddingBottom = "20px";

// Create the first <div> with class "card card-block card-stretch card-height" and background color
                        const cardDiv = document.createElement("div");
                        cardDiv.classList.add("card", "card-block", "card-stretch", "card-height");
                        cardDiv.style.backgroundColor = "rgb(242, 247, 248)";

// Create the inner <div> with class "card-body"
                        const cardBodyDiv = document.createElement("div");
                        cardBodyDiv.classList.add("card-body");

// Create the <div> for the image
                        const imageDiv = document.createElement("div");
                        imageDiv.classList.add("d-flex", "align-items-center", "justify-content-between", "mb-4");

// Create the icon element with bootstrap icon from bootstrap-icons
                        const image = document.createElement("i");
                        image.classList.add("bi", "bi-building", "text-primary");
                        image.style.fontSize = "50px";

// Create the <h5> element with class "mb-1 card-title modal-detail-title"
                        const title = document.createElement("h5");
                        title.classList.add("mb-1", "card-title", "modal-detail-title");
                        title.textContent = currentDp.name;

// Create the <div> for the group of avatar images
                        const avatarGroupDiv = document.createElement("div");
                        avatarGroupDiv.classList.add("d-flex", "align-items-center", "justify-content-between", "pt-3", "border-top");

                        const mediaGroup = document.createElement("div");
                        mediaGroup.classList.add("iq-media-group");

// Create and append the avatar icons
                        for (let i = 0; i < 1; i++) {
                            const avatarLink = document.createElement("a");
                            avatarLink.href = "#";
                            avatarLink.classList.add("iq-media")

                            const avatarIcon = document.createElement("i");
                            avatarIcon.classList.add("bi", "bi-person-circle", "text-primary");
                            avatarIcon.style.fontSize = "30px";
                            avatarLink.appendChild(avatarIcon);
                            mediaGroup.appendChild(avatarLink);
                        }

// Create the "See More" button
                        const seeMoreButton = document.createElement("a");
                        seeMoreButton.href = "";
                        seeMoreButton.classList.add("btn", "btn-white", "text-secondary", "link-shadow");
                        seeMoreButton.setAttribute("dp-id", currentDp.id);
                        a("Department Id : "+currentDp.id);
                        seeMoreButton.dataset.bsToggle = "modal";
                        seeMoreButton.dataset.bsTarget = "#department-details";
                        seeMoreButton.textContent = "See More";

                        seeMoreButton.addEventListener("click", function (e) {

                            getData(`/api/department/byId/${currentDp.id}`, (error, data) => {

                                if(error) {
                                    a(error)
                                } else {
                                    document.querySelector("#edit-department-name").value = data.name
                                }

                            })
                            getData(`/api/user/count/departmentId/${currentDp.id}`,(error, data) => {
                                if(error){
                                    a(error)
                                } else{
                                    document.querySelector("totalMember").value = data
                                }
                            })
                            getData(`/api/`)
                        })

// Append elements to construct the structure
                        outerDiv.appendChild(cardDiv);
                        cardDiv.appendChild(cardBodyDiv);
                        cardBodyDiv.appendChild(imageDiv);
                        imageDiv.appendChild(image);
                        cardBodyDiv.appendChild(title);
                        avatarGroupDiv.appendChild(mediaGroup);
                        cardBodyDiv.appendChild(avatarGroupDiv);
                        avatarGroupDiv.appendChild(seeMoreButton);



// Append the container div to the document or the desired parent element

                        fragment.appendChild(outerDiv)
                    }
                motherContainer.appendChild(fragment);
            })
            .catch(error => {
                // Handle errors, if any
                console.error('Error:', error);
            });






        fragment.childNodes.forEach(node => {
            console.log('fragment child',node);
        });

        document.addEventListener("DOMContentLoaded", function () {
            // Your JavaScript code here
            // Including the code that appends elements to the DOM

        });



    </script>
</head>

<body>

<!-- Spinner Start -->
<div id="spinner"
     class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
    <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
        <span class="sr-only">Loading...</span>
    </div>
</div>
<!-- Spinner End -->

<div th:replace="fragments/sidebar :: sidebar"></div>

<div class="container-fluid position-relative bg-white d-flex p-0">
    <!-- Content Start -->
    <div class="content" style="
                    background-color: #e5e5f7;
                    opacity: 1;
                    background-image: radial-gradient(
                        #444cf7 0.6000000000000001px,
                        #e5e5f7 0.6000000000000001px
                    );
                    background-size: 12px 12px;
                ">
        <!-- Navbar Start -->
        <div th:replace="fragments/navigation :: navigation-with-search"></div>
        <!-- Navbar End -->

        <!-- Search Start -->
        <div class="container-fluid d-md-block pt-2 ps-s pe-2" id="dropdrown-search-bar">
            <div class="d-flex flex-row justify-content-end gap-2">
                <form class="d-inline-block">
                    <input class="form-control border-0" type="search" placeholder="Search"/>
                </form>


                <!-- add department modal start -->

                <!-- add department modal end -->
                <!-- sortting button -->
                <i class="bi bi-sort-alpha-down sort-btn text-dark"></i>

                <!-- Modal -->
            </div>
        </div>
        <!-- Search End -->

        <!-- department start -->

        <div id="grid" class="item-content animate__animated animate__fadeIn active" data-toggle-extra="tab-content">
            <div class="row" id="sort-container" style="margin: 10px">
            </div>
        </div>
        <!-- department end -->
    </div>
    <!-- Content End -->

    <!-- modal for department's details -->
    <div class="modal fade" id="department-details" data-bs-keyboard="true">
        <div class="modal-dialog modal-dialog-centered modal-xl modal-fullscreen-sm-down modal-fullscreen-lg-down">
            <div class="modal-content">
                <div class="modal-header" style="background-color: #369; color: white">
                    <h5 class="modal-title" id="staticBackdropLabel">
                        Department Details
                    </h5>
                    <button type="button" class="btn-close text-white btn-close-white" data-bs-dismiss="modal"
                            aria-label="Close"></button>
                </div>


                <div class="modal-body">
                    <!-- TODO :: SHOW DEPARTMENT'S DETAILS -->
                    <div class="container-fluid">
                        <div class="row">
                            <div class="card">
                                <div class="card-body profile-card pt-4 d-flex flex-column align-items-center">
                                    <!--icon-->
                                    <div class="profile-card-icon">
                                        <i class="bi bi-building-fill text-primary" style="font-size: 100px"></i>
                                    </div>
                                    <h4 style="margin-top: 10px">Department Head</h4>
                                    <h5 id = "departmethead">Lai Kuan Lin</h5>

                                </div>
                            </div>
                            <div class="pt-3">
                                <!-- Bordered Tabs -->
                                <ul class="nav nav-tabs nav-tabs-bordered">
                                    <li class="nav-item">
                                        <button class="nav-link active" data-bs-toggle="tab"
                                                data-bs-target="#profile-overview">Overview
                                        </button>
                                    </li>

                                    <li class="nav-item">
                                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#profile-edit">
                                            Edit
                                        </button>
                                    </li>
                                </ul>
                                <div class="tab-content pt-3">
                                    <div class="tab-pane fade show active profile-overview" id="profile-overview">
                                        <div class="row row-cols-lg-1 row-cols-sm-1 row-cols-md-1 row-cols-xl-2">
                                            <ul class="list-group col" style="padding: 0;">
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    Total Project<span class="badge bg-primary rounded-pill" id="totalProject"></span>
                                                </li>
                                                <br/>
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    Total Member<span class="badge bg-primary rounded-pill" id="totalMember"></span>
                                                </li>
                                            </ul>
                                            <div class="col">
                                                <canvas style="max-width: 960px; padding: 0; min-width: 300px"
                                                        id="department-projects-chart" height="200"></canvas>
                                            </div>

                                        </div>
                                    </div>

                                    <div class="tab-pane fade profile-edit pt-3" id="profile-edit">
                                        <form>
                                            <div>
                                                <label >Department Name</label>
                                                <br/><br/>
                                                <input type="text" class="form-control" name="departmentname"
                                                       placeholder="Department Name" id="edit-department-name"/>
                                            </div>
                                            <br/>
                                            <div>
                                                <label for="departmenthead">Choose Deparment Head:</label><br/><br/>
                                                <select name="departmenthead" class="form-control">
                                                    <option value="volvo">Phyoe Wai Yan</option>
                                                    <option value="saab">Zaw Lin Shein</option>
                                                    <option value="opel">Thant Htet Ko</option>
                                                </select>
                                            </div>
                                            <br/>

                                            <button style="
                                                        background-color: #369;
                                                    " type="submit" class="btn btn-primary py-2 w-100 mb-3"
                                                    id="loign-btn">Edit
                                            </button>
                                        </form>
                                    </div>
                                </div>
                                <!-- End Bordered Tabs -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- modal for department's details -->

    <!-- Back to Top -->
</div>

<!-- add department modal -->
<div class="modal fade" id="add-department-modal" data-bs-keyboard="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <!-- TODO :: REDESIGN FORM FOR ADDING DEPARTMENT -->
                <form>
                    <h1 class="modal-title fs-5" style="
                                    margin-bottom: 10px;
                                    text-align: center;
                                    color: #369;
                                    font-weight: bold;
                                ">Add Department</h1>
                    <div>
                        <label>Department Name</label> <br/><br/>
                        <input type="text" class="form-control" name="departmentname" placeholder="Department Name"/>
                    </div>
                    <br/>
                    <div>
                        <label for="departmenthead">Choose Deparment Head:</label><br/><br/>
                        <select name="departmenthead" id="departmenthead" class="form-control">
                            <option value="volvo">Phyoe Wai Yan</option>
                            <option value="saab">Zaw Lin Shein</option>
                            <option value="opel">Thant Htet Ko</option>
                        </select>
                    </div>
                    <br/>

                    <button style="background-color: #369" type="submit" class="btn btn-primary py-2 w-100 mb-3">
                        Add
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- add department modal -->

<!--    for select drop-drown-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>

<!-- fontawesome -->
<script src="/js/fontawesome.js"></script>

<!-- jquery -->
<script src="/js/jquery.3.7.1.min.js"></script>

<!-- datable table -->
<script src="/js/databales.min.js"></script>

<!-- bootstrap -->
<script src="/js/bootstrap.bundle.min.js"></script>

<!-- javascript libraries -->
<script src="/lib/chart/chart.min.js"></script>
<script src="/lib/easing/easing.min.js"></script>
<script src="/lib/waypoints/waypoints.min.js"></script>
<script src="/lib/owlcarousel/owl.carousel.min.js"></script>
<script src="/lib/tempusdominus/js/moment.min.js"></script>
<script src="/lib/tempusdominus/js/moment-timezone.min.js"></script>
<script src="/lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>
<script src="/lib/quill/quill.min.js"></script>

<!-- Template Javascript -->
<script src="/js/main.js"></script>
<script src="/js/forprogresscircleiguess.js"></script>

<!-- sort (department, project), form validation and search bar behavior are all here -->
<script src="/js/custome.js"></script>
<script>

    function fetchDepartments() {
        var departmentId = $('#departmentId').val();
        $.ajax({
            url: '/lists?id=' + departmentId,  // Include the ID in the URL as a query parameter
            type: 'GET',
            success: function (data) {
                // Handle the successful response here
                var departmentList = $('#departmentList');
                departmentList.empty();  // Clear the previous content
                $.each(data, function (index, department) {
                    departmentList.append('<p>' + department.name + '</p>');  // Assuming "name" is a field in DepartmentDto
                });
            },
            error: function (error) {
                // Handle any errors here
                console.error(error);
            }
        });
    }

    const ctx = document.getElementById("department-projects-chart");

    const firstChart = new Chart(ctx, {
        type: "line",
        data: {
            labels: [
                "January",
                "February",
                "March",
                "Apirl",
                "May",
                "June",
                "July",
                "August",
                "September",
                "October",
                "November",
                "December",
            ],

            datasets: [
                {
                    label: "project one",
                    backgroundColor: "rgba(255, 111, 200, 0.5)",
                    data: [0, 0, 3, 5, 2, 3],
                    fill: true,
                    borderColor: "rgb(255, 111, 200)",
                    pointRadius: 0,
                    borderWidth: 1,
                },
                {
                    label: "project two",
                    backgroundColor: "rgba(100, 111, 200, 0.5)",
                    data: [20, 10, 58, 12],
                    fill: true,
                    borderColor: "rgb(100, 111, 200)",
                    pointRadius: 0,
                    borderWidth: 1,
                },
                {
                    label: "project one",
                    backgroundColor: "rgba(255, 0, 0, 0.5)",
                    data: [23, 85, 10, 5, 25, 7, 65, 77, 10],
                    fill: true,
                    borderColor: "rgb(255, 0, 0)",
                    pointRadius: 0,
                    borderWidth: 1,
                },
                {
                    label: "project one",
                    backgroundColor: "rgba(0, 255, 0, 0.5)",
                    data: [5, 50, 10, 5, 54, 3, 65],
                    fill: true,
                    borderColor: "rgb(0, 255, 0)",
                    pointRadius: 0,
                    borderWidth: 1,
                },
                {
                    label: "project one",
                    backgroundColor: "rgba(0, 0, 255, 0.5)",
                    data: [
                        89, 45, 33, 15, 25, 3, 34, 44, 58, 89, 45, 33,
                    ],
                    fill: true,
                    borderColor: "rgb(0, 0, 255)",
                    pointRadius: 0,
                    borderWidth: 1,
                },
            ],
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true,
                },
            },
            animation: {
                duration: 2000,
            },
            legend: {
                display: true,
            },
            responsive: true
        },
    });


    console.log(firstChart);
    firstChart.config.options.animation.duration = 5000;

    let departmentHeads;
    function getDepartmentHeads() {
        fetch('api/user/departmenthead')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                departmentHeads = data;
            })
            .catch(error => {
                console.error("Error fetching data via Fetch:", error);
            });
    }
    $('#departmenthead').change(function() {
        var selectDepartmentHead = $("selectDepartmentHead");
        var selectedDepartmentHead = "";




    $.get('/api/user/list/DEPARTMENT_HEAD', function(data) {
        selectDepartmentHead.empty();
        $.each(data, function(index, department) {
            selectDepartmentHead.append($('<option>', {
                value: department.id, // Adjust this based on your data
                text: department.name // Adjust this based on your data
            }));
        });
    });
    });



    $(document).ready(function() {
        $("#load-data").click(function() {
            $.ajax({
                url: "api/user/count", // URL to the API endpoint
                type: "GET", // HTTP method (GET, POST, etc.)
                dataType: "json", // Data type to expect in response
                success: function(data) {

                    console.log(data);
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    // Handle errors
                    console.log("Error: " + textStatus, errorThrown);
                }
            });
        });
    });



</script>
</body>
</html>
